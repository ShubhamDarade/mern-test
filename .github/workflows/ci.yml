# name: Node.js CI

# on:
#   pull_request:
#     branches:
#       - main
#       - master

# jobs:
#   Test:
#     runs-on: ubuntu-latest
#     container:
#       image: node:20

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
#         with:
#           node-version: 20

#       - name: Install dependencies
#         run: npm install

#       - name: Run tests
#         env:
#           PORT: ${{ secrets.PORT }}
#           MONGO_URI: ${{ secrets.MONGO_URI }}
#         run: npm test

#       - name: Upload test results if tests fail
#         if: failure()
#         uses: actions/upload-artifact@v3
#         with:
#           name: test-results
#           path: test-results.xml

# ------------------------------------------------------------------------

# name: Node.js CI

# on:
#   pull_request:
#     branches:
#       - main
#       - master

# jobs:
#   setup:
#     name: Setup
#     runs-on: ubuntu-latest
#     container:
#       image: node:20

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
#           node-version: 20

#       - name: Install dependencies
#         run: npm install

#       - name: Cache node_modules
#         uses: actions/cache@v3
#         with:
#           path: node_modules
#           key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}
#           restore-keys: |
#             ${{ runner.os }}-node-modules-

#   prettier:
#     name: Prettier Check
#     runs-on: ubuntu-latest
#     needs: setup

#     steps:
#       - name: Restore node_modules from cache
#         uses: actions/cache@v3
#         with:
#           path: node_modules
#           key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}
#           restore-keys: |
#             ${{ runner.os }}-node-modules-

#       - name: Run Prettier check
#         run: npx prettier --check .

#   test:
#     name: Run Tests
#     runs-on: ubuntu-latest
#     needs: setup

#     steps:
#       - name: Restore node_modules from cache
#         uses: actions/cache@v3
#         with:
#           path: node_modules
#           key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}
#           restore-keys: |
#             ${{ runner.os }}-node-modules-

#       - name: Run tests
#         env:
#           PORT: ${{ secrets.PORT }}
#           MONGO_URI: ${{ secrets.MONGO_URI }}
#         run: npm test

#       - name: Upload test results if tests fail
#         if: failure()
#         uses: actions/upload-artifact@v3
#         with:
#           name: test-results
#           path: test-results.xml

# -----------------------------------------------------------------------

# name: Node.js CI

# on:
#   pull_request:
#     branches:
#       - main
#       - master

# jobs:
#   # Prettier job
#   prettier:
#     name: Prettier Check
#     runs-on: ubuntu-latest
#     container:
#       image: node:20

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
#         with:
#           node-version: 20

#       - name: Install dependencies
#         run: npm install

#       - name: Run Prettier check
#         run: npx prettier --check .

#   # Test job
#   test:
#     name: Run Tests
#     runs-on: ubuntu-latest
#     container:
#       image: node:20

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v3
#         with:
#           node-version: 20

#       - name: Install dependencies
#         run: npm install

#       - name: Run tests
#         env:
#           PORT: ${{ secrets.PORT }}
#           MONGO_URI: ${{ secrets.MONGO_URI }}
#         run: npm test

#       - name: Upload test results if tests fail
#         if: failure()
#         uses: actions/upload-artifact@v3
#         with:
#           name: test-results
#           path: test-results.xml

# ---------------------------------------------------------------------

name: Node.js CI

on:
  pull_request:
    branches:
      - main
      - master

jobs:
  # Job for setup (checkout and installing dependencies)
  setup:
    name: Setup
    runs-on: ubuntu-latest
    container:
      image: node:20

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          pnode-version: 20

      - name: Install dependencies
        run: npm install

      - name: Cache node_modules
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-modules-

  # Prettier job
  prettier:
    name: Prettier Check
    runs-on: ubuntu-latest
    needs: setup # This job depends on the 'setup' job

    steps:
      - name: Restore node_modules from cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-modules-

      - name: Run Prettier check
        run: npx prettier --check .

  # Test job
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    needs: setup # This job depends on the 'setup' job

    steps:
      - name: Restore node_modules from cache
        uses: actions/cache@v3
        with:
          path: node_modules
          key: ${{ runner.os }}-node-modules-${{ hashFiles('package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-modules-

      - name: Run tests
        env:
          PORT: ${{ secrets.PORT }}
          MONGO_URI: ${{ secrets.MONGO_URI }}
        run: npm test

      - name: Upload test results if tests fail
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: test-results.xml
